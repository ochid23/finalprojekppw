<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Sesi Konsultasi - ALOG</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>

  <!-- Google Font -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet"/>
</head>
<body>

  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg bg-body-tertiary shadow-sm sticky-top">
    <div class="container">
      <a class="navbar-brand fw-bold text-primary" href="index.html">ALOG | Amikom Psikolog</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto fw-semibold">
          <li class="nav-item"><a class="nav-link" href="index.html">Beranda</a></li>
          <li class="nav-item"><a class="nav-link" href="layanan.html">Booking</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- Chat Panel -->
  <main class="d-flex flex-column" style="min-height: 90vh;">
    <!-- Header Chat -->
    <header class="d-flex align-items-center justify-content-between p-3 border-bottom bg-white">
      <div class="d-flex align-items-center gap-2">
        <img src="https://i.pravatar.cc/150?u=psikolog" alt="Avatar Dokter" class="rounded-circle" width="40" height="40"/>
        <div>
          <div class="fw-semibold">Dr. Citra</div>
          <small class="text-success">Online</small>
        </div>
      </div>
      <div class="text-end">
        <span class="fw-semibold me-3" id="timer">Sisa waktu: 30:00</span>
        <button class="btn btn-sm btn-outline-danger" onclick="akhiriSesi()">Akhiri Sesi</button>
      </div>
    </header>

    <!-- Chat Area -->
    <div class="p-3 overflow-auto" id="chatArea" style="background-color: #f2f2f2; height: calc(100vh - 250px);">
      <!-- Pesan dari Anda -->
      <div class="d-flex justify-content-end mb-3">
        <div class="text-end">
          <div class="fw-semibold">Anda <small class="text-muted">21:15</small></div>
          <div class="bg-primary text-white rounded p-2 mt-1">Selamat malam, Dok.</div>
        </div>
      </div>

      <!-- Pesan dari Dokter -->
      <div class="d-flex mb-3">
        <div>
          <div class="fw-semibold">Dr. Citra <small class="text-muted">21:16</small></div>
          <div class="bg-light border rounded p-2 mt-1">Selamat malam, Budi. Bagaimana perasaan Anda hari ini?</div>
        </div>
      </div>
    </div>

    <!-- Input -->
    <footer class="p-3 border-top bg-white">
      <form class="d-flex gap-2" onsubmit="kirimPesan(); return false;">
        <input type="text" id="inputPesan" class="form-control" placeholder="Ketik pesan untuk Dr. Citra..." required />
        <button type="submit" class="btn btn-primary">Kirim</button>
      </form>
    </footer>
  </main>

  <!-- Footer -->
  <footer class="bg-light py-3">
    <div class="container">
      <div class="row align-items-center text-center text-md-start">
        <div class="col-md-6 mb-3 mb-md-0">
          <h5 class="fw-bold text-primary mb-1">ALOG | Amikom Psikolog</h5>
          <p class="text-muted small mb-0">Dukungan psikologis terpercaya untuk mahasiswa Universitas Amikom Yogyakarta.</p>
        </div>
        <div class="col-md-6 text-md-end">
          <ul class="list-inline mb-2">
            <li class="list-inline-item"><a href="index.html" class="text-decoration-none text-muted small">Beranda</a></li>
            <li class="list-inline-item"><a href="layanan.html" class="text-decoration-none text-muted small">Booking</a></li>
          </ul>
          <p class="text-muted small mb-0">&copy; 2025 ALOG - Universitas Amikom Yogyakarta</p>
        </div>
      </div>
    </div>
  </footer>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Timer & Chat Script -->
<script>
  const GEMINI_API_KEY = "AIzaSyBViTVZwe8EMEZnKDqdznS_a4ah6ls9QM8"; // API kamu

  let totalSeconds = 30 * 60;
  const timerInterval = setInterval(updateTimer, 1000);

  function updateTimer() {
    const minutes = String(Math.floor(totalSeconds / 60)).padStart(2, '0');
    const seconds = String(totalSeconds % 60).padStart(2, '0');
    document.getElementById('timer').textContent = `Sisa waktu: ${minutes}:${seconds}`;
    if (totalSeconds > 0) {
      totalSeconds--;
    } else {
      clearInterval(timerInterval);
      alert('Waktu sesi telah habis.');
    }
  }

  function akhiriSesi() {
    if (confirm("Apakah Anda yakin ingin mengakhiri sesi?")) {
      alert("Sesi telah diakhiri.");
    }
  }

  async function kirimPesan() {
    const input = document.getElementById("inputPesan");
    const pesan = input.value.trim();
    if (pesan === "") return;

    const chatArea = document.getElementById("chatArea");
    const time = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });

    const userBubble = `
      <div class="d-flex justify-content-end mb-3">
        <div class="text-end">
          <div class="fw-semibold">Anda <small class="text-muted">${time}</small></div>
          <div class="bg-primary text-white rounded p-2 mt-1">${pesan}</div>
        </div>
      </div>
    `;
    chatArea.insertAdjacentHTML('beforeend', userBubble);
    chatArea.scrollTop = chatArea.scrollHeight;
    input.value = "";

    try {
      const response = await fetch('https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=' + GEMINI_API_KEY, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          contents: [{ parts: [{ text: pesan }] }]
        })
      });

      const data = await response.json();
      const balasan = data.candidates?.[0]?.content?.parts?.[0]?.text || "Maaf, saya tidak bisa menjawab saat ini.";

      const aiBubble = `
        <div class="d-flex mb-3">
          <div>
            <div class="fw-semibold">Dr. Citra <small class="text-muted">${new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}</small></div>
            <div class="bg-light border rounded p-2 mt-1">${balasan}</div>
          </div>
        </div>
      `;
      chatArea.insertAdjacentHTML('beforeend', aiBubble);
      chatArea.scrollTop = chatArea.scrollHeight;

    } catch (error) {
      console.error("Error:", error);
      alert("Gagal mendapatkan balasan dari AI.");
    }
  }
</script>

</body>
</html>
